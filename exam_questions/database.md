# DataBase

[Какие реляционные базы данных вы знаете](#какие-реляционные-базы-данных-вы-знаете)

[Что такое реляционные базы данных](#что-такое-реляционные-базы-данных)

[Формы нормализации](#формы-нормализации)

[Что такое язык SQL и зачем он нужен](#что-такое-язык-sql-и-зачем-он-нужен)

[Типы джойнов (join)](#типы-джойнов-join)

[Что знаете о нереляционных базах данных](#что-знаете-о-нереляционных-базах-данных)

[Какие преимущества Nosql баз данных перед реляционными базами](#какие-преимущества-nosql-баз-данных-перед-реляционными-базами)

[Что такое транзакции](#что-такое-транзакции)

[ACID](#acid)

[Уровни изолированности транзакций](#уровни-изолированности-транзакций)

[Связи между таблицами](#связи-между-таблицами)

[Индексы в SQL. Что это](#индексы-в-sql-что-это)

[Оптимизация запросов. Какие инструменты](#оптимизация-запросов-какие-инструменты)

[Блокировки и локи. Оптимистичная и Пессимистичная](#блокировки-и-локи-оптимистичная-и-пессимистичная)

[Чем WHERE отличается от HAVING](#чем-where-отличается-от-having)

# Какие реляционные базы данных вы знаете

PostgreSQL, MySQL, Oracle Database, Microsoft SQL Server

[К оглавлению](#DataBase)

# Что такое реляционные базы данных

Реляционные базы данных — это системы управления базами данных (СУБД), которые хранят данные в виде таблиц, где каждая
строка представляет собой запись, а каждый столбец — атрибут. Для обеспечения уникальности записей используется
первичный ключ. Каждая таблица может быть связана с другими таблицами с помощью внешних ключей, что позволяет
моделировать сложные структуры данных. Реляционные базы данных используют язык запросов SQL для работы с данными:
создания таблиц, вставки данных, поиска данных в таблице, объединение таблиц.

[К оглавлению](#DataBase)

# Формы нормализации

Нормализация — это процесс организации данных в реляционной базе данных с целью устранения избыточности и предотвращения
аномалий при вставке, обновлении и удалении данных. Нормализация включает несколько этапов, которые называются
нормальными формами. Основные из них:

Первая нормальная форма (1NF):

+ Каждое поле в таблице должно содержать только атомарные (неделимые) значения. То есть, каждая ячейка таблицы должна
  содержать одно значение.
+ Пример: если в таблице для контактов есть поле, которое содержит несколько номеров телефона через запятую, это не
  соответствует 1NF, нужно разделить на отдельные строки или таблицы.

Вторая нормальная форма (2NF):

+ Таблица должна быть в 1NF, и все неключевые атрибуты должны зависеть от всего первичного ключа, а не только от части
  его. Это устраняет частичные зависимости, когда неключевое поле зависит только от части составного ключа.
+ Пример: если у нас есть таблица, где хранится информация о заказах и покупателях, и покупатель имеет несколько
  заказов, то данные о покупателе не должны повторяться для каждого заказа.

Третья нормальная форма (3NF):

+ Таблица должна быть в 2NF, и не должно быть транзитивных зависимостей. То есть, неключевые атрибуты не должны зависеть
  от других неключевых атрибутов.
+ Пример: если в таблице есть поля адрес и город, и город зависит от почтового кода, то город следует вынести в
  отдельную таблицу, чтобы избежать транзитивной зависимости.

Четвертая нормальная форма (4NF)

Пятая нормальная форма (5NF)

Бойс-Кодд нормальная форма (BCNF)

[К оглавлению](#DataBase)

# Что такое язык SQL и зачем он нужен

SQL (Structured Query Language) — это специализированный язык запросов, предназначенный для работы с реляционными базами
данных. С помощью SQL мы можем управлять данными в базе данных: создавать, изменять, удалять таблицы, а также извлекать,
обновлять и удалять данные.

SQL состоит из нескольких типов операторов:

DML (Data Manipulation Language) — операторы для манипуляции данными:

+ SELECT — извлечение данных из таблицы.
+ INSERT — добавление новых записей в таблицу.
+ UPDATE — обновление существующих данных.
+ DELETE — удаление данных.

DDL (Data Definition Language) — операторы для определения структуры базы данных:

+ CREATE — создание новых объектов (например, таблиц, индексов, представлений).
+ ALTER — изменение структуры существующих объектов (например, добавление столбцов).
+ DROP — удаление объектов из базы данных.

DCL (Data Control Language) — операторы для управления доступом:

+ GRANT — предоставление прав доступа пользователю.
+ REVOKE — удаление прав доступа.

TCL (Transaction Control Language) — операторы для управления транзакциями:

+ COMMIT — завершение транзакции и сохранение изменений.
+ ROLLBACK — откат изменений, сделанных в текущей транзакции.

SQL используется для того, чтобы эффективно работать с реляционными базами данных, обеспечивая возможность не только
извлекать данные, но и изменять их, создавать структуру базы данных, а также контролировать транзакции и доступ.
Понимание SQL является ключевым для работы с реляционными базами данных и тесно связано с разработкой приложений,
использующих эти базы данных.

[К оглавлению](#DataBase)

# Типы джойнов (join)

JOIN — это операция в SQL, которая позволяет объединять строки из двух и более таблиц на основе логической связи между
ними. Джойны используются, чтобы получить данные, которые находятся в разных таблицах, но связаны между собой через
ключи или другие условия.

Есть несколько типов джойнов, которые различаются по тому, какие строки из таблиц будут возвращены в результат запроса:

INNER JOIN:

+ Возвращает только те строки, которые имеют совпадения в обеих таблицах по указанному условию.
+ Если в одной из таблиц нет соответствующих строк для другой таблицы, такие строки не попадут в результат.
+ Это самый распространенный тип джойна.

```java
SELECT employees.name, departments.name AS department_name
FROM employees
INNER JOIN departments ON employees.department_id = departments.id;
```

LEFT JOIN (или LEFT OUTER JOIN):

+ Возвращает все строки из левой таблицы и те строки из правой таблицы, которые соответствуют условию. Если в правой
  таблице нет совпадений, для этих строк будут возвращены значения NULL.
+ Используется, когда важно получить все строки из левой таблицы, даже если для них нет совпадений в правой.

```java
SELECT employees.name, departments.name AS department_name
FROM employees
LEFT JOIN departments ON employees.department_id = departments.id;
```

RIGHT JOIN (или RIGHT OUTER JOIN):

+ Аналогичен LEFT JOIN, но возвращает все строки из правой таблицы, даже если нет соответствующих строк в левой таблице.
+ Это менее распространённый тип, но его можно использовать в случаях, когда важно сохранить все строки из правой
  таблицы.

```java
SELECT employees.name, departments.name AS department_name
FROM employees
RIGHT JOIN departments ON employees.department_id = departments.id;
```

FULL JOIN (или FULL OUTER JOIN):

+ Возвращает все строки из обеих таблиц. Если для строки из одной таблицы нет соответствующей строки в другой, в
  результирующем наборе будет стоять NULL для недостающих значений.
+ Используется, когда важно получить все строки из обеих таблиц, независимо от того, есть ли у них соответствия.

```java
SELECT employees.name, departments.name AS department_name
FROM employees
FULL JOIN departments ON employees.department_id = departments.id;
```

CROSS JOIN:

+ Возвращает декартово произведение строк из двух таблиц, т.е. каждая строка из первой таблицы объединяется с каждой
  строкой из второй таблицы.
+ Это может привести к большому количеству строк в результате, особенно если обе таблицы содержат много записей.

```java
SELECT employees.name, departments.name AS department_name
FROM employees
CROSS JOIN departments;
```

SELF JOIN:

+ Применяется для объединения таблицы самой с собой.

```java
SELECT e1.name AS employee1, e2.name AS manager
FROM employees e1
INNER JOIN employees e2 ON e1.manager_id = e2.id;
```

[К оглавлению](#DataBase)

# Что знаете о нереляционных базах данных

Нереляционные базы данных, или NoSQL базы данных, — это системы управления базами данных, которые не используют таблицы
и связи, как в реляционных базах данных. Они предназначены для работы с большими объемами данных, которые могут быть
разнообразными по структуре, и когда важна гибкость в хранении и быстродействие.

[К оглавлению](#DataBase)

# Какие преимущества Nosql баз данных перед реляционными базами

NoSQL базы данных поддерживают различные типы данных, такие как документы в формате JSON (например, MongoDB),
ключ-значение (например,
Redis), графы (например, Neo4j), и колонки (например, Cassandra). Это позволяет выбрать базу данных, которая лучше
подходит для конкретного типа приложения. NoSQL базы данных часто лучше подходят для хранения и обработки больших
объёмов данных и могут эффективно работать с
неструктурированными или полуструктурированными данными.

[К оглавлению](#DataBase)

# Что такое транзакции

Транзакция — это последовательность операций, которые выполняются как единое целое. Важно, что транзакция либо
завершается полностью (все операции выполнены), либо не выполняется вообще, если возникает ошибка. Это помогает
поддерживать целостность данных. Транзакции обеспечивают ACID-свойства

[К оглавлению](#DataBase)

# ACID

+ Atomicity (Атомарность) — транзакция либо выполняется полностью, либо не выполняется вообще. Если происходит сбой на
  любом шаге, все изменения отменяются.
+ Consistency (Согласованность) — транзакция переводит базу данных из одного согласованного состояния в другое. После
  выполнения транзакции данные остаются целостными и валидными.
+ Isolation (Изоляция) — транзакции изолированы друг от друга. Операции одной транзакции не видны другим, пока она не
  завершится. Это предотвращает влияние параллельных транзакций друг на друга.
+ Durability (Долговечность) — как только транзакция завершена, ее изменения сохраняются, даже если система падает.

[К оглавлению](#DataBase)

# Уровни изолированности транзакций

В реляционных базах данных существует четыре уровня изолированности транзакций, которые определяют, как одна транзакция
видит изменения другой. Чем выше уровень, тем сильнее защита от одновременных изменений данных, но и тем ниже
производительность.

Read Uncommitted (Чтение неподтверждённых данных)

+ Транзакция может читать неподтверждённые (незавершённые) изменения других транзакций.
+ Проблема: грязное чтение (Dirty Read) — можно прочитать данные, которые потом будут откатаны.

Read Committed (Чтение подтверждённых данных)

+ Транзакция видит только подтверждённые изменения других транзакций.
+ Проблема: неповторяющееся чтение (Non-Repeatable Read) — повторное чтение одной и той же строки может вернуть разные
  результаты, если другая транзакция её изменила.

Repeatable Read (Повторяемое чтение)

+ Гарантирует, что если транзакция читает строку, она не изменится до её завершения.
+ Проблема: фантомные чтения (Phantom Read) — другая транзакция может вставить новые строки, которые не были в исходном
  запросе.

Serializable (Сериализуемость)

+ Самый строгий уровень. Обеспечивает полную изоляцию транзакций, они выполняются как бы по очереди.
+ Полностью устраняет все проблемы, но снижает производительность.

В PostgreSQL по умолчанию используется уровень Read Committed, но можно выбрать другой в зависимости от требований к
данным.

[К оглавлению](#DataBase)

# Связи между таблицами

Связи между таблицами бывают один к одному, один ко многим и многие ко многим. Они реализуются через внешние ключи в SQL
и аннотации (@OneToOne, @OneToMany, @ManyToMany) в JPA.

[К оглавлению](#DataBase)

# Индексы в SQL. Что это

Индекс это ключ, построенный из одного или нескольких столбцов в базе данных, который ускоряет выборку. При этом, чем
больше дубликатов в столбце - тем хуже работает индекс.

+ Плюсы: Улучшают производительность для select и сортировки по определенным полям
+ Минусы: Ухудшается производительность, когда нужно вставлять, обновлять или удалять данные. Требуется дополнительное
  место и чем больше/длиннее ключ - тем больше размер индекса

[К оглавлению](#DataBase)

# Оптимизация запросов. Какие инструменты

+ EXPLAIN – Показывает план выполнения запроса, что позволяет увидеть, как СУБД планирует извлекать данные. 
+ EXPLAIN ANALYZE – Выполняет запрос и показывает реальный план выполнения, включая затраченные ресурсы (время, память). 
+ Indexes – Индексы ускоряют доступ к данным, особенно при использовании в условиях WHERE. 
+ pg_stat_statements (для PostgreSQL) – Модуль для сбора статистики выполнения запросов.

[К оглавлению](#DataBase)

# Блокировки и локи. Оптимистичная и Пессимистичная

Блокировки (или локи) в базе данных — это механизм, который помогает управлять параллельным доступом к одним и тем же данным, чтобы избежать ошибок и конфликтов. Есть два типа блокировок:

+ Оптимистическая блокировка. При сохранении данных проверяется, не изменились ли они с момента их чтения. Если изменились — происходит ошибка, и нужно повторить транзакцию.
+ Пессимистическая блокировка. Означает, что данные блокируются сразу, чтобы другие транзакции не могли их изменить, пока текущая транзакция не завершится.

#### Оптимистичная блокировка:

+ Используется, когда конфликты редки.
+ Проверяется, изменились ли данные с момента их чтения.

```java
SELECT version FROM orders WHERE id = 1;
-- Обновляем, если версия не изменилась
UPDATE orders 
SET status = 'processed', version = version + 1
WHERE id = 1 AND version = 5;
```

#### Пессимистичная блокировка:

+ Блокирует данные, чтобы другие транзакции не могли их изменить.

```java
SELECT * FROM orders WHERE id = 1 FOR UPDATE;
```

[К оглавлению](#DataBase)

# Чем WHERE отличается от HAVING

WHERE применяется до выполнения агрегатных функций, а HAVING - после

[К оглавлению](#DataBase)